
乘区之间为相乘计算，乘区之内为相加计算；

# 伤害乘区

1. 基础属性乘区

	基础属性攻击力，分为基础值“白值”和额外值“黄值”；
		白值：角色属性基础值 + 武器数值；
		黄值：白值的百分比加成 + 其他加成；
	
	百分比攻击力来源：
		武器属性；
		声骸属性 + 声骸词条；
		命座；
		食物收益；

```cpp
int nBaseAttack = CurHero.nAttack + CurWeapon.nAttack
int nExtraAttack = nBaseAttack * fAttackRate + nOtherAttack

int nFinalAttack = nBaseAttack + nExtraAttack
```
	

![500](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20240608090434.png)



2. 倍率乘区

	一般指技能倍率；

3. 伤害加成乘区

	分为：
		伤害类型加成：
			普攻加成；
			重击加成；
			共鸣技能加成；
			共鸣解放加成；
		各种属性加成：
			物理；
			冷凝；
			热熔；
			导电；
			启动；
			衍射；

4. 伤害加深乘区

	一般由延奏技能提供；

![500](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20240608092223.png)


5. 暴击乘区

	伤害期望 = 暴击率 * 暴击伤害 * 伤害 + (1 - 暴击率) * 伤害；
$$
\begin{align}
y&:CriticalDamage\space[1,\infty]\\
x&:CriticalChance\space[0,1]\\
y&=kx\\
E_{rate}&=xy+(1-x)\\
&=kx^2-x+1\\
\end{align}
$$

```cpp
float fCriticalChance;
float fCriticalDamage;

bool bCritical = random(0.f, 1.f) <= fCriticalChance;

float fDamage = nDamage;
if (bCritical)
{
	fDamage *= fCriticalDamage;
}
```

6. 防御乘区

	测试组经过测试得到的等级-防御公式（不确保正确）：

$$
R_{defense}=\frac{100+L_{hero}}{199+L_{monster}+L_{hero}}
$$

7. 抗性乘区

	以下为测试组结论：
		当抗性大于0时，为(1-抗性值)；
		当抗性小于0时，暂时未知；

![500](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20240608102117.png)


 
8. 伤害减免乘区

	一般只有五音区的负面效果使用了该乘区；

# 伤害类型

普攻；
重击；
共鸣技能；
共鸣解放；
延奏技能；
变奏技能；
声骸技能；

# 伤害计算

模拟输出循环，计算总倍率；
分析每种类型的伤害所占的比例；

暴击转化为暴击期望；
每种增伤转化为等效总增伤；
攻击力加成转化为等效百分比攻击力；
 


`SSAO`是一种在3D计算机图形中用于模拟环境光遮蔽的技术；
环境光遮蔽可以增加场景的真实感，通过模拟微小的阴影来增强图像的深度和体积感；
# 环境光遮蔽

环境光遮蔽（`Ambient Occlusion`）是一种用于模拟全局照明的计算机图形技术；它的主要目的是为了在三维模型的各个部分之间添加更多的真实感和深度感；

![AO|500](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20230910201424.png)

# 重要假设

1. 假设间接光照是一个常数（类似`Blinn-Phong`中的`Ambient`）；
2. 假设有些shading Point接收不到环境光；
3. 假设所有的材质都是diffuse的；

# 思想

一个点是否被遮蔽，取决于其附近一定范围内的几何分布；

![SSAO|600](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20230911202511.png)

对于每个像素点，根据深度图，判断其法线方向半球的几何遮蔽情况；
# 步骤

1. 深度和法线信息：首先，你需要从深度缓冲器（Depth Buffer）和法线缓冲器（Normal Buffer）中获取每个像素的深度和法线信息。深度信息用于判断一个像素是否被其他像素遮挡，而法线信息用于判断遮挡的方向；

2. 采样：对于屏幕上的每一个像素，都会在其周围采样多个点。采样的方式有很多种，例如可以在一个半球体内随机采样，也可以使用预定义的采样模式。采样的数量和分布会直接影响到SSAO的效果和性能；

3. 遮蔽计算：对于每一个采样点，都会计算其深度和法线信息，然后与当前像素的深度和法线信息进行比较，以判断这个采样点是否对当前像素产生了遮蔽效果。如果一个采样点的深度大于当前像素的深度，并且其法线方向与当前像素的法线方向相近，那么就认为这个采样点对当前像素产生了遮蔽效果；

4. 遮蔽累加：将所有采样点的遮蔽效果累加起来，得到当前像素的总遮蔽效果。然后将这个遮蔽效果归一化，得到一个在0到1之间的遮蔽因子；

5. 应用遮蔽：最后，将遮蔽因子应用到当前像素的颜色上，得到最终的渲染结果。通常，遮蔽因子会被用来减少像素的亮度，从而模拟环境光遮蔽的效果；


# 采样方法

以下是一些常见的采样策略：

1. 随机采样：在每个像素周围随机选择一些点进行采样。这种方法简单易实现，但可能会导致噪点和不稳定的效果；

2. 均匀采样：在每个像素周围按照一定的模式均匀地选择一些点进行采样，例如在一个半球体内均匀地选择点。这种方法可以得到更稳定的效果，但计算复杂度较高；

3. 基于深度的采样：根据像素的深度信息来选择采样点。例如，对于靠近相机的像素，可以选择更多的采样点，而对于远离相机的像素，可以选择较少的采样点。这种方法可以更好地模拟真实的光照效果，但需要更多的计算资源；

4. 基于法线的采样：根据像素的法线信息来选择采样点。例如，对于面向相机的像素，可以选择更多的采样点，而对于背向相机的像素，可以选择较少的采样点。这种方法可以更好地模拟物体表面的细节，但需要更多的计算资源；

# HBAO

`HBAO`与`SSAO`非常类似，可以看作是`SSAO`的改进；

不同的是，`HBAO`会考虑每个采样点的方向，只有当采样点的方向与当前像素的法线方向相近时，才会认为这个采样点对当前像素产生了遮蔽效果，并根据与法线夹角的大小加权计算遮蔽；

这种方法可以更准确地模拟环境光的遮蔽效果，但计算复杂度也更高；
`NiagaraEffectType`（Niagara特效类型）是虚幻中专门用来控制特效效率、性能预算和全局行为的核心工具。

它不仅仅是用来“分类”的，更重要的是它定义了**一类特效在性能受限时该如何表现**。
# 1. 什么是 Niagara Effect Type？

你可以把它理解为特效的**配置模板**或**阶级身份**。

在制作游戏时，你会有成千上万个特效（开枪、爆炸、环境雨雪、脚印等）。如果每个特效都要单独去设置“离得远了就不显示”或者“同屏最多显示多少个”，工作量巨大且难以维护。

`NiagaraEffectType` 允许你创建一个配置文件（比如叫 `NET_Combat`），然后把所有战斗相关的特效都指向这个文件。当你修改这个文件中的参数时，所有关联的特效都会立刻应用这些性能规则。

# 2. 如何控制效率？

`NiagaraEffectType` 主要通过以下三个维度来控制性能：

## A. 剔除（Culling）—— 最直接的性能节省
这是它最强大的功能。你可以设置规则，告诉引擎何时“杀死”或“休眠”特效：
*   **距离剔除 (Distance Culling)：** 比如设置“超过 50 米就不渲染”。
*   **视锥剔除 (Frustum Culling)：** 如果特效不在摄像机画面内，是否还要计算它？
*   **剔除反应 (Culling Reaction)：** 当满足剔除条件时，特效该做什么？
    *   `Sleep`: 暂停计算，省CPU，再次看见时继续播放（适合循环特效）。
    *   `Deactivate`: 停止生成新粒子，让现有粒子自然消失。
    *   `Kill`: 直接销毁，最省性能（适合稍纵即逝的特效）。

## B. 预算管理（Budgeting / Max Instances）
为了防止画面太乱或显卡爆炸，你可以限制同类特效的数量。
*   **最大实例数 (Max System Instances)：** 比如设定“弹孔”类型的特效同屏最多 50 个。
*   **超出预算时的行为：** 当第 51 个弹孔生成时，是禁止生成新的？还是把最早生成的第 1 个弹孔强行删掉？

## C. 可伸缩性 (Scalability)
你可以针对不同的画质等级（Low, Medium, High, Epic）设置不同的规则。
*   例如：在 PC 端（Epic）允许 500 个粒子，而在手机端（Low）只允许 50 个，且剔除距离更短。

# 3. 实战案例

假设你在做一个射击游戏，你可以创建两种 `NiagaraEffectType`：

**类型 1：`NET_Critical` (关键特效)**
*   **用途：** 玩家的大招、BOSS的技能。
*   **设置：**
    *   **优先级：** 最高。
    *   **剔除距离：** 无限（或者很远），不管玩家在哪都要能看到。
    *   **数量限制：** 不限制，或者限制很高。
    *   **被剔除时：** 仅仅休眠，不销毁。

**类型 2：`NET_Ambient` (环境/装饰特效)**
*   **用途：** 远处的烟雾、地上的落叶、子弹撞墙的火花。
*   **设置：**
    *   **优先级：** 低。
    *   **剔除距离：** 20米（离远了就不算了）。
    *   **数量限制：** 比如同屏最多 20 个。
    *   **被剔除时：** 直接 `Kill`（销毁），因为玩家根本不在乎少看了一个火花。

**结果：** 当战斗激烈、特效满天飞导致性能压力大时，引擎会优先保留 `NET_Critical` 的特效，自动清理掉 `NET_Ambient` 的特效，从而保证帧率稳定。

# 4. 关键属性详解 (Technical Breakdown)

当你打开一个 Niagara Effect Type 资产时，重点关注 `Update` 和 `Culling` 区域：

1.  **Update Frequency (更新频率)：**
    *   引擎不需要每帧都去检查这个特效是否该被剔除。你可以设置为 `Low`，比如每秒只检查 5 次，这样检查本身的开销也很低。

2.  **Cull Reaction (剔除反应)：**
    *   **Asleep / Waking:** 适合循环特效（如火堆）。离开视线暂停，回来继续。
    *   **Deactivate / Activate:** 适合持续发射的特效。离开视线停止发射，回来重新发射。
    *   **Kill:** 适合一次性特效（如爆炸）。没看见就直接删了，省内存。

3.  **Significance Handler (重要性处理)：**
    *   配合 UE 的 Significance Manager，动态计算特效的重要性（比如距离越近越重要），从而动态调整 LOD。

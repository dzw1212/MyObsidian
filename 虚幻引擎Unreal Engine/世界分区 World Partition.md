UE5 中引入的一项革命性技术，旨在取代旧有的“世界场景构成（World Composition）”系统。它是专为**大型开放世界**设计的资源管理和渲染解决方案。

以下是对世界分区的详细介绍，涵盖其核心概念、关键特性、工作原理及优势。

---

### 1. 核心概念：为什么要用它？
在传统的工作流中，大型地图通常被分割成许多个子关卡（Sub-levels），开发者需要手动管理这些关卡的加载和卸载。这导致了两个痛点：
*   **协作困难：** 多个开发者同时修改同一个子关卡文件会产生冲突。
*   **管理繁琐：** 开发者必须手动决定什么时候加载哪个块。

**世界分区**将整个世界视为一个**单一的持久化关卡（Persistent Level）**，它在后台自动将地图划分为网格，并根据与玩家的距离动态处理加载/卸载。

---

### 2. 核心特性

#### A. 一个文件一个物体 (One File Per Actor, OFPA)
这是世界分区最关键的辅助特性。
*   **原理：** 在过去，整个关卡的所有信息都存在一个 `.umap` 文件里。现在，每个 Actor（如一棵树、一栋楼）都被保存为独立的小文件。
*   **优势：** 团队协作时，不同的人可以同时修改同一个区域的不同物体，而不会产生源代码管理（如 Perforce 或 Git）的冲突。

#### B. 自动网格划分 (Automatic Grid-based Streaming)
*   **原理：** 系统将世界在二维平面上划分为正方形网格（Cells）。
*   **运行时加载：** 系统根据玩家摄像机的位置，自动加载周围预设半径内的网格。
*   **分层存储：** 你可以设置多个运行时网格（Runtime Grids），例如：
    *   **近景网格：** 加载距离短，细节高。
    *   **远景网格：** 加载距离长，只放大型地标。

#### C. 数据层 (Data Layers)
*   **原理：** 类似于图层，但不仅限于组织物体。它可以在运行时通过代码或蓝图动态开启或关闭。
*   **应用场景：** 同一个区域的“白天版本”和“夜晚版本”，或者“任务前”和“任务后”的场景破坏效果。你可以根据需要流式加载特定的数据层。

#### D. 分级细节 (HLOD - Hierarchical Level of Detail)
*   **原理：** 当物体距离玩家非常远时，世界分区会自动使用 HLOD 将多个复杂的网格体合并为一个简单的网格体和一张贴图。
*   **优势：** 极大地减少了渲染调用（Draw Calls），使得玩家可以看到极远处的地平线而不会导致性能崩溃。

---

### 3. 工作流与操作

1.  **启用：** 创建新关卡时选择“Open World”模板，或在关卡设置中勾选“Enable World Partition”。
2.  **世界分区窗口：** 在编辑器中，你会看到一个名为“World Partition”的小地图窗口。你可以通过框选区域来手动加载/卸载特定的网格块，以便在编辑器中进行创作（注意：这只影响编辑器视图，不影响游戏运行）。
3.  **转换：** 虚幻引擎提供了工具（Commandlet），可以将旧的“世界场景构成”地图转换为新的“世界分区”格式。

---

### 4. 世界分区 vs. 世界场景构成 (对比)

| 特性 | 世界场景构成 (旧 - UE4) | 世界分区 (新 - UE5) |
| :--- | :--- | :--- |
| **关卡结构** | 多个子关卡文件 (.umap) | 一个持久化关卡 + 独立 Actor 文件 |
| **加载机制** | 手动划分关卡边界 | 自动基于距离的网格加载 |
| **多人协作** | 容易冲突 (锁定整个子关卡) | 极低冲突 (一个物体一个文件) |
| **远景处理** | 需手动设置 LOD 关卡 | 自动集成 HLOD 系统 |
| **动态控制** | 较难实现复杂的场景切换 | 通过“数据层”轻松实现 |

---

### 5. 优势总结

1.  **性能优化：** 只渲染和加载玩家周围必要的内容，极大节省显存和内存。
2.  **无限规模：** 理论上支持创建极其巨大的地图，而不会受到编辑器性能的限制。
3.  **极大提升协作效率：** 解决了大型团队协作时的文件占用锁定问题。
4.  **无缝体验：** 玩家在世界中移动时，不会感受到关卡加载的卡顿（Loading Screen）。

### 6. 适用建议
*   **中大型开放世界：** 强烈推荐使用，这是 UE5 的核心工作流。
*   **小型室内场景：** 如果你的关卡很小且能一次性装入内存，则没必要开启，传统的单关卡模式更简单。

总的来说，**世界分区**是 UE5 为了实现《黑神话：悟空》或《赛博朋克2077》这类体量游戏而设计的基石技术，它配合 **Nanite**（虚拟化微多边形几何体）和 **Lumen**（动态全局光照），构成了虚幻5处理次世代画面的“三驾马车”。
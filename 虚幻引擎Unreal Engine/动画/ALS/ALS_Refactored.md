`ALS_Refactored` 是对虚幻引擎著名的“高级运动系统V4”（Advanced Locomotion System V4, 简称ALS V4）进行完全重构和改进的C++版本。它的核心目标是使这个本已强大的系统更易于理解、更灵活、更可靠（尤其是在网络多人游戏中）、性能更高，并且使用起来更愉快。

# 特点

相比于普通的运动系统（例如虚幻引擎自带的第三人称模板），甚至是原版的ALS V4，`ALS_Refactored` 具有以下显著的不同和优势：

|             | 普通系统/ALSv4                                                 | ALS_Refactored                                                                                                                                         |
| ----------- | ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 结构          | 一个庞大而笨重的动画蓝图（AnimBP），所有逻辑都塞在一起，难以扩展和维护                     | 将单一的巨型动画蓝图拆分成了多个链接动画图表（`Linked Animation Graph`）。 这种模块化的结构使得管理和扩展特定功能（如持枪、持剑等姿态）变得更加清晰和简单。同时，它将内容分为主系统、相机系统和额外功能三个模块，结构非常清晰                            |
| Control Rig | 严重依赖动画图中的IK节点和大量的虚拟骨骼（Virtual Bones）来进行脚部IK、手部IK等骨骼调整      | 全面拥抱并使用虚幻引擎现代化的 **Control Rig** 插件来完成IK和所有其他的骨骼操作。 这不仅性能更高，也大大减少了所需的虚拟骨骼数量，使得骨架设置更干净                                                                   |
| 网络同步和性能     | 网络同步需要开发者手动处理大量细节，很容易出错。原版ALS V4虽然有网络同步，但在复杂情况下的可靠性有时会受到质疑 | 对角色移动组件（`UAlsCharacterMovementComponent`）进行了重写，以实现更可靠、更优秀的多人网络同步效果。 它还利用了UE的新特性，如Push Model和Iris复制系统，来优化数据传输。 同时，通过将动画逻辑移至工作线程，提升了游戏主线程的性能             |
| 扩展性         | 切换武器姿态或动作模式（例如从徒手到持枪）通常需要复杂的动画蓝图逻辑和硬编码引用                   | 使用 **Gameplay Tags** 来取代硬编码的枚举（Enums），用于定义和切换角色的姿态（Overlay States）。 并且它利用动画层接口（Animation Layer Interfaces）在运行时动态切换这些姿态，而不是直接在动画蓝图中引用，这大大提高了系统的灵活性和可扩展性 |

# 结构

![1200](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251108230425.png)


![600](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251108230451.png)

## Standing

处理角色在**站立姿态**下的所有动作。包括站立空闲（Idle）、站立行走/奔跑（Walk/Run）的状态机和混合逻辑；

---

缓存六方向的移动Pose（为什么不是八方向）：

![1000](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251108235515.png)

每个方向都通过一个2D的混合空间来计算，**横轴为步幅，纵轴为走/跑**：

![700](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251109001353.png)

---

处理疾跑：
	通过`SprintAccelerationAmount`来混合 **疾跑稳定姿态 Sprint** 和 **疾跑加速姿态 Sprint Acceleration**；
	通过`Gait`来混合 跑 与 疾跑；
	通过`SprintBlockAmount`来判断当前是否可以播放疾跑动作，比如落地等动作期间不适合混合疾跑动作；

![1200](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251109114744.png)

---

移动状态机：
	*该状态机通过角色的移动方向和臀部方向锁定曲线（Hips Direction Lock Curve），对不同的方向性动画进行融合，从而在切换运动方向或调整臀部朝向时，实现更平滑、更优秀的混合过渡效果*
	

![600](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251109115904.png)



---

身体倾斜：


![1000](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20251109115452.png)


## Crouching

处理角色在**下蹲姿态**下的所有动作。包括下蹲空闲（Crouch Idle）和下蹲移动（Crouch Walk）的状态机和混合逻辑；

## Ground

负责处理角色处于地面上（非跳跃、非坠落）的所有核心逻辑；

## Locomotion

这是一个通用的模块，用于处理移动方向、速度、角色的平滑转身（Turn-in-place）、启动（Start）、停止（Stop）动画等核心的移动过渡逻辑；

## Overlay

负责将独立于移动的动画混合到角色的身体上。典型的应用是：
1. 上半身瞄准/持枪动画（Upper Body）；
2. 持械/非持械的姿势切换；
3. 特殊动作（如开门、拾取）；

## Layering

这是一个核心的**混合阶段**。它负责将基础移动动画 (Locomotion)、覆盖动画 (Overlay)的输出，通过 `Blend Poses by Bone`（按骨骼混合姿势）或 `Anim Layer Interface` 进行最终组合。它确保不同身体部位的动画能够正确地混合在一起，例如下半身运行，上半身瞄准；

## Head

专门处理头部和眼睛的看向（Look-at）/注视（Gaze）逻辑。它让角色的头部可以平滑地转向目标点（如摄像机看向的方向或特定的NPC）；

## Control Rig

骨骼控制	通常是最终输出前的调整阶段，用于应用 Control Rig 实例。这些 Rig 可以用于：
1. IK（逆向动力学）：确保脚部正确地踩在地面上（Foot IK）；
2. 其他运行时骨骼修正：如武器附着、姿势微调等；

## Ragdolling

专门处理角色的**死亡**、**受击倒地**、或**特殊物理模拟状态**。当角色进入布娃娃状态时，这个模块会接管动画输出，启用物理模拟；


**Animation Warping（动画扭曲/变形）** 是一套非常强大的程序化动画插件。它主要用于解决一个经典难题：**如何让一套有限的动画素材，完美适配角色各种变化的速度、方向和地形，而不会产生“滑步”或“动作对不上”的问题。**

它通常和 **Motion Warping**（位移扭曲，用于翻窗、暗杀等位移对齐）区分开。Animation Warping 专注于**基础移动（Locomotion）**。

以下是它的核心功能、用法以及为什么它在现代游戏开发中（包括你正在看的 ALS 类似系统）如此重要。

---
# 核心功能

#### 1. Orientation Warping (方向扭曲) —— 解决“侧跑”问题

*   **功能：** 它可以通过程序化地旋转角色的骨骼（通常是腰部以下），让一个“向前跑”的动画看起来像是在“斜着跑”。
*   **优势：** 你不需要准备“前、后、左、右、左前、右前...”等 8 个方向的动画。你甚至**只需要 1 个向前跑的动画**，通过插件就能扭曲出任意 360 度的跑法，且脚部完全不打滑。

#### 2.  Stride Warping (步幅扭曲) —— 解决“滑步”问题

*   **功能：** 当角色的移动速度和动画原本的步幅不匹配时，它会动态伸长或缩短角色的腿部骨架。
*   **场景：** 比如你的跑步动画是每秒 5 米，但玩家现在加速到了每秒 7 米。传统的做法是加快动画播放速度（变鬼畜），而 Stride Warping 则是让角色**步子迈得更大**，保持步频合理。

#### 3. Slope Warping (坡度扭曲) —— 解决“斜坡”问题

*   **功能：** 自动调整角色的脚部、膝盖和臀部位置，使其适应上下坡。
*   **场景：** 让角色在斜坡上行走时，脚底始终平贴地面，身体重心保持垂直，而不是像传统的动画那样直接穿模或者浮空。

---

# 如何使用

在 UE5 中，Animation Warping 已经集成为内置插件。

#### 第一步：开启插件
在编辑器中搜索并启用 `Animation Warping` 插件。

#### 第二步：准备 IK Rig
这套系统高度依赖 **IK (Inverse Kinematics)**。你需要为你的角色创建一个 `IK Rig`，定义好：
*   **Retarget Root**（通常是 Pelvis/盆骨）
*   **IK Chains**（左腿、右腿的链）
*   **IK Goals**（脚部控制点）

#### 第三步：在动画蓝图（AnimGraph）中使用
在 AnimGraph 中，你会发现多了一些节点：
1.  **Orientation Warping 节点：** 
    *   输入：当前动画 Pose。
    *   参数：`Locomotion Angle`（移动方向角）。
    *   作用：它会自动根据角度旋转你的大腿和脚。
2.  **Stride Warping 节点：**
    *   输入：Pose。
    *   参数：`Actual Speed`（实际速度）和 `Gait Speed`（动画原生速度）。
    *   作用：自动拉伸腿部。

#### 第四步：配合脚部锁死（Foot Locking）
为了让效果完美，通常会配合 `Offset Root Bone` 等节点，确保在扭曲过程中脚不会在地面上摩擦。

# Stride Warping节点

在不改变动画播放速度（即不让动作变“鬼畜”）的前提下，通过程序化拉长或缩短角色的腿部，使步伐跨度完美匹配角色的实际移动速度；

![1000](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103030526.png)


## 模式

这是一个非常核心的设置，决定了 **Stride Warping 节点如何获取“动画原本的速度”**。

在 UE5 的动画变形架构中，这两个模式代表了两种完全不同的工作流：**“手动计算”** vs **“引擎自动推算”**。
### 1. Manual（手动模式）
这是最传统、最容易理解，但也最费工的模式。

*   **工作原理**：你需要手动告诉节点“动画预期的步幅是多少”。
*   **表现**：在节点上，你会看到 **Stride Distance** 或 **Stride Scale** 之类的输入引脚是激活的。
*   **你需要做的事**：
    1.  在逻辑中计算：`当前角色速度 / 动画原生速度`。
    2.  将计算结果每帧传给该引脚。
*   **优缺点**：
    *   **优点**：完全可控。如果你想在某些特殊状态下（比如角色受重伤瘸腿）故意增大或减小步幅，手动模式最方便。
    *   **缺点**：非常繁琐。如果你的 BlendSpace 混合了“走路(300速度)”、“慢跑(600速度)”、“冲刺(900速度)”，你很难在蓝图中精准实时地算出当前混合状态下的“理论原生速度”。

![300](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103020851.png)


### 2. Graph（图表/自动模式）
这是 UE5 真正强大的地方，也是现代运动系统的首选。

*PS：使用该模式，5.4以上引擎版本需要主动打开动画序列的Enable Root Motion开关；*

*   **工作原理**：引擎会**向上追溯（Look-back）动画图表**，查看前一个节点（比如你的 BlendSpace）产生的**Root Motion Delta（根运动增量）**。

*   **核心逻辑**：
    1.  节点会检查当前播放的动画序列：*“根据这个动画的根运动数据，这一帧模型本该移动 10 厘米。”*
    2.  节点再看物理组件的实际位移：*“但这一帧物理上角色实际上移动了 15 厘米。”*
    3.  **自动计算**：它自动得出比例 `15 / 10 = 1.5`，然后直接应用 1.5 倍的 Stride Warping。
*   **表现**：手动的速度输入引脚通常会被隐藏或失效，取而代之的是自动的补偿。

*   **先决条件**：
    *   你的动画序列（Animation Sequence）**必须包含根运动（Root Motion）数据**（即骨骼资产中的 Root 骨骼必须有位移）。

*   **优缺点**：
    *   **优点**：**极度自动化**。无论你的 BlendSpace 如何复杂，或者你在不同动画间切换，引擎都能通过根运动数据实时计算出完美的步幅比例，完全不需要写复杂的数学公式。
    *   **缺点**：对资源有要求。如果你的动画资产是纯“原地（In-place）”动画且没有任何根运动轨迹数据，Graph 模式将无法工作（因为它不知道动画本该走多快）。

![300](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103020916.png)

## 参数

![600](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103022242.png)


Pelvis骨骼控制两根大腿Thigh；

![200](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103021341.png)

![300](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103021352.png)

IK_Foot_Root骨骼控制脚部的IK；

![200](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103021601.png)

![250](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103021607.png)

# Orientation Warping 节点

该节点为了解决**身体朝向与移动方向不一致**的问题，在 ALS 这种高级运动系统中，它是实现**平滑侧跑**而不产生滑步的关键；

![800](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103041702.png)

## 模式

**Orientation Warping** 节点和 Stride Warping 一样，也拥有 **Manual（手动）** 和 **Graph（图表/自动）** 两种评估模式（Evaluation Mode）。

它们的核心区别在于：**谁来决定“扭曲的角度”？**

### 1. Manual (手动模式)
这是目前开发者最常用的模式，尤其是在从 ALS 这种系统过渡过来的项目中。

*   **工作原理**：需要输入一个自定义的`Orientation Angle`（需要扭曲的角度）；
	* 该值完全是写死的，比如说左前的动作应该是前的-45度，右前是前的45度，而对于前/后/左/右来说，完全不需要旋转，则应该传入0；

*   **适用场景**：
    *   你想要完全掌控扭曲的时机。
    *   你的动画资产没有根运动（Root Motion）轨迹。
    *   你正在实现类似 ALS 的复杂逻辑，需要根据特定的枚举状态（如 Forward, Backward）来手动修正角度（比如在跑向后面时，你可能需要手动给角度加减 180 度）。

![250](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103033938.png)

*Manual模式目前有些问题，比如不同方向之间的混合时间没有生效、侧向时的StrideWarping没有生效等，使用时需要注意；*

### 2. Graph Mode (图表/自动模式)
这是 UE5 推崇的“高度程序化”模式，它比手动模式更智能，但也对资源有要求。

*   **工作原理**：需要输入一个`Locomotion Angle`（应该朝向的角度）；
	* 与`Orientation Angle`不同，该模式下会计算当前使用的动画资产的运动角度（需要带根位移），比如对于一个向左的动画，传入0的话，会导致角色侧着往前走，因此对于向左时直接传目标角度，即-90度即可；

*   **核心要求**：
    *   **动画必须带有根运动数据**。虽然角色不需要开启 Root Motion 驱动，但轨迹数据必须存在。如果你用一个原地（In-Place）且没有任何 Root 轨迹的动画，Graph 模式将无法判断“动画原本的方向”，导致扭曲失效。

![250](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103034041.png)

## 参数

**脊椎骨骼链**：从盆骨Pelvis到锁骨Clavicle的一系列骨骼，节点会自动平摊扭曲角度。比如角色要往右转 45 度，它会分配给每节脊椎扭转 15 度，这样看起来很自然；

![250](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103033233.png)

![300](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103033225.png)

![400](https://pic-1315225359.cos.ap-shanghai.myqcloud.com/20260103033502.png)


# Slope Warping节点


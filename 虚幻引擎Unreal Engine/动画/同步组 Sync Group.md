**同步组（Sync Groups）** 是动画系统里一个非常核心且实用的功能。它的主要目的是**协调两个或多个不同长度的动画，使它们在混合（Blending）时保持相位一致**。

如果不使用同步组，当你从“走路”切换到“跑步”时，因为两个动作的频率和时长不同，可能会出现“脚滑”或“瞬间瞬移”的现象。

以下是对同步组的详细拆解：

---

# 1. 核心原理：领导者与跟随者（Leader & Follower）

同步组基于一个简单的角色分配机制：
*   **领导者（Leader）：** 在同步组中，混合权重最高的那个动画节点（通常是当前主要播放的动作）会被自动选为领导者。领导者决定了整个组的播放速度和当前的播放进度百分比。
*   **跟随者（Follower）：** 组内其他权重较低的动画都是跟随者。它们会**强制拉伸或压缩自己的时长**，以匹配领导者的步调。
*   **动画通知（Notifies）：** 默认情况下，只有“领导者”的动画通知会被触发，跟随者的通知会被抑制，以防止重复触发（如重复的脚步声）。

# 2. 同步的两种方式

## A. 基于长度的同步（Length-based Syncing）

这是最基础的同步方式。如果两个动画都没有设置同步标记，系统会直接按**时间比例**进行同步。
*   **例子：** 走路动画 1 秒，跑步动画 0.5 秒。当混合到 50% 时，跑步动画会强行拉伸到 1 秒来适配走路。
*   **缺点：** 这种方式要求两个动画的节奏完全一致（比如都是在 0.2 秒落左脚，0.7 秒落右脚）。如果节奏稍微偏差，脚部依然会产生漂移。

## B. 基于标记的同步（Marker-based Syncing）—— 强烈推荐

这是目前主流的做法。你在动画序列的 Notify 轨道中手动添加“同步标记”（Sync Markers）。
*   **操作：** 给走路和跑步动画都在脚落地的时刻添加名为 `L_Foot_Down` 和 `R_Foot_Down` 的标记。
*   **原理：** 引擎不再看时间百分比，而是看**标记之间的相对位置**。如果领导者正处于“左脚落地”到“右脚落地”路径的 30% 位置，跟随者也会被强行对齐到其自身这两个标记间的 30% 位置。
*   **优势：** 即使动画节奏不同（比如跑步步幅极大，走路步幅极小），只要标记位置准确，脚部落地永远是严丝合缝的。

# 3. 同步组角色（Group Roles）

在动画蓝图的节点细节（Details）面板中，你可以通过 `Group Role` 调整节点的行为：
*   **Can Be Leader（默认）：** 谁权重高谁当老大。
*   **Always Leader：** 强制该节点为老大，无视权重。
*   **Never Leader：** 永远当小弟，只会被动适配别人。
*   **Transition Leader / Follower：** 这是 UE5 中增强的功能，专门用于处理状态机切换时的过渡平滑度。

在绝大多数情况下，你**不需要手动设置**谁是 Leader，谁是 Follower。虚幻引擎有一套自动选举机制。

## 1. 默认逻辑：权重越高，话语权越大

在同步组中，默认的 Role 是 **`Can Be Leader`**。

当你从“走路”切换到“跑步”时（无论是在混合空间里移动摇杆，还是在状态机里发生转换）：
*   **切换开始时：** 走路的混合权重是 1.0（100%），跑步是 0。此时**走路是 Leader**，跑步必须对齐走路的进度。
*   **切换中期：** 走路和跑步权重各占 0.5（50%）。此时引擎会根据内部优先级决定，但通常此时两者已经高度同步了。
*   **切换结束时：** 跑步的权重变成了 1.0（100%），走路变成了 0。此时**跑步自动篡位变成了 Leader**，走路（如果还没完全消失）成了 Follower。

**结论：** 权力是随着混合权重（谁更明显）而**动态漂移**的。这种动态切换保证了过渡过程中的节奏是平滑过度的。

## 2. 什么时候需要手动设置 Role？

虽然默认的“按权重分配”很好用，但在某些特殊需求下，你需要打破这个规则：

### A. 设置为 `Always Leader` (永远的指挥官)
如果你希望某个动画**始终控制全局节奏**，无视它现在的权重是多少。
*   **例子：** 你有一个“受伤瘸腿”的动画，节奏非常特殊。你希望无论角色怎么跑，都必须严格遵守那个瘸腿动画的步点，否则动作会崩。这时你可以把受伤动画设为 `Always Leader`。

### B. 设置为 `Never Leader` (永远的追随者)
如果你希望某个动画**只准听别人的，不准带节奏**。
*   **例子：** 叠层动画（Layered Animation）。比如你有一个“拍肚子”的循环动作加在身体上，你希望它完全适配你走路的步点，但你绝对不希望“拍肚子”的长度反过来影响你走路的速度。这时把拍肚子设为 `Never Leader`。

# 4. 实际操作步骤

1.  **添加同步标记：**
    *   打开动画序列（Animation Sequence）。
    *   在通知轨道右键 -> **添加同步标记（Add Sync Marker）**。
    *   给所有相关的动作（走、跑、蹲、移）在相同步相（如左脚落地、右脚落地）打上相同名字的标记。
2.  **设置同步组名：**
    *   在动画蓝图（AnimBP）的 **AnimGraph** 中，选中对应的动画节点（如 `Sequence Player` 或 `BlendSpace`）。
    *   在右侧“细节”面板找到 **Sync Group** 栏。
    *   在 **Group Name** 输入一个组名（如 "Locomotion"）。**注意：所有需要互相同步的节点必须共用同一个组名。**
    *   将 **Method** 设置为 `Sync Group`。

# 5. 常见应用场景与注意事项

*   **混合空间（Blend Space）：** 混合空间内部通常会自动处理同步，但如果你在多个 BlendSpace 之间切换（例如从“空手走跑”切换到“持枪走跑”），就需要手动给这两个 BlendSpace 指定同一个同步组名。
*   **状态机切换：** 当你从一个状态（Idle/Walk）过渡到另一个状态（Run）时，设置同步组可以保证过渡瞬间脚不会乱跳。
*   **匹配起点：** 同步组虽然强大，但最好的实践依然是**确保参与同步的所有动画在起始帧具有相同的步相**（例如第一帧都是左脚落地）。
*   **必须是循环动画：** 同步组通常用于循环播放的 Locomotion 动画。对于单次播放（Montage 等）的动作，通常不使用同步组。

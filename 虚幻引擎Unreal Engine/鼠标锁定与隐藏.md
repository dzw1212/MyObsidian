*游戏中有这么一种需求，平常操控人物时需要隐藏鼠标，并且无论怎么移动鼠标都不会离开游戏窗口；当打开UI界面时，要显示鼠标，并且超出边界时可以离开游戏窗口*

这种需求通过切换 **输入模式（Input Mode）** 和 **鼠标锁定状态（Mouse Lock Mode）** 来实现。

主要涉及 `PlayerController` 提供的三个核心函数。以下是针对你描述的两种情况的详细处理方案：

---

### 1. 操控人物时（隐藏鼠标，且不离开窗口）

在这种状态下，鼠标通常用于控制视角旋转（Yaw/Pitch），需要被“捕获”在窗口中心并隐藏。

*   **输入模式**：使用 `Set Input Mode Game Only`。
*   **鼠标锁定**：将锁定模式设置为 `LockAlways` 或 `LockInFullscreen`。
*   **光标显示**：`bShowMouseCursor = false`。

**蓝图实现逻辑：**
1. 获取 **Player Controller**。
2. 调用 **Set Input Mode Game Only**。
3. 在该节点中将 **Mouse Lock Mode** 设置为 `Lock Always`（始终锁定）。
4. 设置 **Set Show Mouse Cursor** 为 `False`。

**C++ 实现：**
```cpp
FInputModeGameOnly InputMode;
InputMode.SetConsumeCaptureMouseDown(true); // 捕获点击
PlayerController->SetInputMode(InputMode);
PlayerController->bShowMouseCursor = false;
PlayerController->SetIgnoreLookInput(false); // 确保可以转动视角
```

---

### 2. 打开 UI 界面时（显示鼠标，可移出窗口）

在这种状态下，鼠标需要恢复正常指针形态，且当它移动到窗口边缘时，允许跨越到显示器其他区域（例如在窗口化模式下点击桌面的其他图标）。

*   **输入模式**：使用 `Set Input Mode Game And UI` 或 `Set Input Mode UI Only`。
*   **鼠标锁定**：将锁定模式设置为 `DoNotLock`。
*   **光标显示**：`bShowMouseCursor = true`。

**蓝图实现逻辑：**
1. 获取 **Player Controller**。
2. 调用 **Set Input Mode Game And UI**（推荐，因为这样 UI 没遮挡的地方点击仍能被游戏识别）。
3. 在该节点中将 **Widget to Focus** 连上你的 UI 控件。
4. 将 **Mouse Lock Mode** 设置为 `Do Not Lock`（不锁定）。
5. 设置 **Set Show Mouse Cursor** 为 `True`。

**C++ 实现：**
```cpp
FInputModeGameAndUI InputMode;
InputMode.SetLockMouseToViewportBehavior(EMouseLockMode::DoNotLock);
InputMode.SetWidgetToFocus(MyWidgetPtr->TakeWidget());
PlayerController->SetInputMode(InputMode);
PlayerController->bShowMouseCursor = true;
```

---

### 核心参数对比表

| 需求场景 | 输入模式 (Input Mode) | 鼠标锁定 (Mouse Lock Mode) | 鼠标显示 (Show Mouse Cursor) |
| :--- | :--- | :--- | :--- |
| **操控人物** | Game Only | **Lock Always** | False |
| **打开UI** | Game and UI / UI Only | **Do Not Lock** | True |

---

### 开发中的常见细节（坑点）：

1.  **焦点问题**：
    当你从 UI 回到游戏模式时，有时需要点击一下屏幕才能恢复视角控制。为了避免这个“多点一下”的问题，在切换回 `Game Only` 时，确保设置 `Player Controller` 的焦点。

2.  **窗口模式的影响**：
    *   在 **编辑器（PIE）** 中测试时，锁定效果可能不如打包后明显（Shift+F1可以强制释放鼠标）。
    *   在 **全屏（Fullscreen）** 模式下，鼠标自然无法移出窗口；该功能主要针对 **窗口化（Windowed）** 或 **窗口全屏（Windowed Fullscreen）** 模式。

3.  **UI 阻挡检查**：
    在 UI 界面下，如果希望鼠标能点击到 UI 背后的游戏世界，使用 `Game and UI`；如果希望完全截断游戏输入，使用 `UI Only`。

### 总结
你只需要编写一个通用的“切换输入模式”的方法，在打开/关闭 UI 的逻辑处调用即可。核心就是通过 **`Set Input Mode`** 节点里的 **`Mouse Lock Mode`** 选项来控制鼠标是否能离开窗口。